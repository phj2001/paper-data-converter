# 纸质数据转换工具 - 完整操作指南

## 目录

1. [项目简介](#项目简介)
2. [系统要求](#系统要求)
3. [环境准备](#环境准备)
4. [安装依赖](#安装依赖)
5. [配置大模型API](#配置大模型api)
6. [启动项目](#启动项目)
7. [使用说明](#使用说明)
8. [常见问题解决](#常见问题解决)

---

## 项目简介

这是一个基于 OCR 的纸质表格识别与转换工具，支持批量上传图片并转换为 Excel 文件。

**主要功能：**
- 支持文件夹批量上传图片
- 基于大模型 API 的高精度表格识别
- 自定义表格列数和列标题
- 实时显示处理进度
- 一键下载 Excel 文件

**技术栈：**
- 后端：FastAPI + Python
- 前端：Vue.js 3 + Vite

---

## 系统要求

| 软件 | 版本要求 | 用途 |
|------|---------|------|
| Python | 3.9 或更高版本 | 后端服务 |
| Node.js | 16.0 或更高版本 | 前端服务 |
| npm | 7.0 或更高版本 | 前端依赖管理 |
| 操作系统 | Windows / macOS / Linux | - |

---

## 环境准备

### 1. 检查 Python 安装

打开命令提示符（CMD）或 PowerShell，执行：

```bash
python --version
```

如果显示版本号（如 Python 3.x.x），说明已安装。

如果未安装或版本过低，请访问 [Python官网](https://www.python.org/downloads/) 下载安装。

### 2. 检查 Node.js 安装

```bash
node --version
npm --version
```

如果显示版本号，说明已安装。

如果未安装，请访问 [Node.js官网](https://nodejs.org/) 下载安装（推荐 LTS 版本）。

---

## 安装依赖

### 步骤 1：克隆或下载项目

将项目文件夹 `纸质数据转换 -网页版` 放置到你想要的目录。

### 步骤 2：安装后端依赖

打开命令提示符（CMD）或 PowerShell，进入后端目录：

```bash
cd "C:\Users\Administrator\Desktop\纸质数据转换 -网页版\backend"
```

安装 Python 依赖：

```bash
pip install -r requirements.txt
```

**如果提示 pip 不是内部命令，尝试：**
```bash
python -m pip install -r requirements.txt
```

### 步骤 3：安装前端依赖

打开**新的**命令提示符窗口，进入前端目录：

```bash
cd "C:\Users\Administrator\Desktop\纸质数据转换 -网页版\frontend"
```

安装 npm 依赖：

```bash
npm install
```

**如果 npm 安装失败，可以尝试：**
```bash
# 清除缓存后重试
npm cache clean --force
npm install
```

---

## 配置大模型API

本项目支持多种主流大模型，需要配置 API 密钥才能正常使用。

### 支持的模型提供商

| 提供商 | 模型示例 | 是否支持视觉 |
|--------|---------|-------------|
| OpenAI | gpt-4o, gpt-4o-mini | 是 |
| Anthropic | claude-3-5-sonnet | 是 |
| Google Gemini | gemini-2.0-flash-exp | 是 |
| 豆包(字节跳动) | 自定义 endpoint | 是 |
| 通义千问(阿里) | qwen-vl-max | 是 |
| 智谱AI | glm-4v | 是 |
| 腾讯混元 | hunyuan-vision | 是 |
| 自定义 | - | 是 |

### 方法一：通过网页界面配置（推荐）

1. 启动项目后访问 http://localhost:3000
2. 点击页面上的「模型配置」按钮
3. 选择提供商、输入 API 密钥和模型名称
4. 保存配置

### 方法二：通过环境变量配置

**Windows (CMD):**
```bash
set ARK_API_KEY=your_api_key_here
set ARK_ENDPOINT_ID=your_endpoint_id_here
```

**Windows (PowerShell):**
```powershell
$env:ARK_API_KEY="your_api_key_here"
$env:ARK_ENDPOINT_ID="your_endpoint_id_here"
```

**macOS / Linux:**
```bash
export ARK_API_KEY=your_api_key_here
export ARK_ENDPOINT_ID=your_endpoint_id_here
```

### 方法三：通过配置文件配置

在 `backend` 目录下创建 `config.json` 文件：

```json
{
  "provider": "doubao",
  "model": "ep-20260104183112-7c7dt",
  "api_key": "your_api_key_here",
  "base_url": null,
  "temperature": 0.01,
  "max_tokens": 4096,
  "timeout": 180
}
```

---

## 启动项目

需要同时启动后端和前端两个服务。

### 启动后端服务（端口 8000）

打开命令提示符，执行：

```bash
cd "C:\Users\Administrator\Desktop\纸质数据转换 -网页版\backend"
python -m uvicorn app:app --host 0.0.0.0 --port 8000 --reload
```

**预期输出：**
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [xxxxx] using WatchFiles
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

### 启动前端服务（端口 3000）

打开**新的**命令提示符窗口，执行：

```bash
cd "C:\Users\Administrator\Desktop\纸质数据转换 -网页版\frontend"
npm run dev
```

**如果 npm run dev 失败，可以尝试直接运行 vite：**
```bash
.\node_modules\.bin\vite.cmd
```

**预期输出：**
```
VITE v5.4.21  ready in 472 ms

➜  Local:   http://localhost:3000/
```

### 访问应用

打开浏览器，访问：

**前端界面：** http://localhost:3000

**后端 API 文档：** http://localhost:8000/docs

---

## 使用说明

### 第一步：上传图片

1. 点击上传区域选择文件夹
2. 或直接拖拽多个图片文件到上传区域
3. 支持的格式：JPG, PNG, BMP, WebP

### 第二步：配置列结构

1. 输入表格的列数（1-20列）
2. 为每列设置标题（如：姓名、年龄、性别等）
3. 点击「预览结构」确认表格格式

### 第三步：处理图片

1. 点击「开始处理」按钮
2. 系统将逐个识别图片中的表格
3. 实时显示处理进度和状态

### 第四步：下载结果

1. 处理完成后点击「下载 Excel」
2. 数据将以统一格式导出到 Excel 文件
3. 文件保存在 `backend/outputs` 目录

---

## 常见问题解决

### 问题 1：Python 命令不识别

**错误提示：**
```
'python' 不是内部或外部命令
```

**解决方法：**
- 尝试使用 `python3` 代替 `python`
- 或重新安装 Python 并勾选「Add Python to PATH」选项

### 问题 2：npm 命令不识别

**错误提示：**
```
'npm' 不是内部或外部命令
```

**解决方法：**
- 确认 Node.js 已正确安装
- 重启命令提示符窗口
- 或使用完整路径：`"D:\installation_direction\Node.js\npm.cmd"`

### 问题 3：pip 安装依赖失败

**错误提示：**
```
ERROR: Could not find a version that satisfies the requirement...
```

**解决方法：**
```bash
# 升级 pip
python -m pip install --upgrade pip

# 使用国内镜像源
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 问题 4：端口被占用

**错误提示：**
```
ERROR: [Errno 48] Address already in use
```

**解决方法：**

**Windows 查找并结束占用进程：**
```bash
# 查找占用 8000 端口的进程
netstat -ano | findstr :8000

# 结束进程（PID 替换为实际进程 ID）
taskkill /PID 进程ID /F
```

或使用其他端口：
```bash
python -m uvicorn app:app --port 8001
```

### 问题 5：API 调用失败

**错误提示：**
```
OCR识别失败: 401 Unauthorized
```

**解决方法：**
- 检查 API 密钥是否正确
- 确认 API 账户有足够的余额
- 检查网络连接是否正常

### 问题 6：CORS 跨域错误

**错误提示：**
```
Access to XMLHttpRequest has been blocked by CORS policy
```

**解决方法：**
- 确保后端服务已启动
- 检查后端地址配置是否正确（默认为 http://localhost:8000）

---

## 停止服务

在运行服务的命令提示符窗口中，按 `Ctrl + C` 停止服务。

---

## 项目目录结构

```
纸质数据转换 -网页版/
├── backend/                 # 后端服务
│   ├── app.py              # FastAPI 主应用
│   ├── requirements.txt    # Python 依赖
│   ├── ocr_processor.py    # OCR 处理器
│   ├── table_processor.py  # 表格处理器
│   ├── excel_writer.py     # Excel 写入器
│   ├── llm_config.py       # 大模型配置管理
│   ├── uploads/            # 上传文件目录
│   └── outputs/            # 输出文件目录
│
├── frontend/               # 前端应用
│   ├── src/
│   │   ├── App.vue        # 主应用组件
│   │   ├── main.js        # 入口文件
│   │   ├── components/    # 子组件
│   │   └── api.js         # API 服务
│   ├── package.json
│   └── vite.config.js
│
└── 操作指南.md            # 本文档
```

---

## 技术支持

如有问题，请检查：

1. Python 和 Node.js 版本是否符合要求
2. 所有依赖是否正确安装
3. API 密钥是否正确配置
4. 端口是否被占用
5. 防火墙是否阻止了服务启动

---

**祝您使用愉快！**
